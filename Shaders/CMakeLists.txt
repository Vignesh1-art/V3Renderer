function(make_first_char_lowercase INPUT_STRING OUTPUT_VARIABLE)
    string(SUBSTRING ${INPUT_STRING} 0 1 FIRST_CHAR)
    string(TOLOWER "${FIRST_CHAR}" LOWERCASE_FIRST_CHAR)
    string(SUBSTRING ${INPUT_STRING} 1 -1 REMAINING_STRING)
    set(${OUTPUT_VARIABLE} "${LOWERCASE_FIRST_CHAR}${REMAINING_STRING}" PARENT_SCOPE)
endfunction()

file(GLOB FILES "*.glsl.*")

foreach(FILE ${FILES})
    get_filename_component(FILE_NAME ${FILE} NAME)
    string(REGEX MATCH "^[^.]*" FIRST_COMPONENT ${FILE_NAME})
    make_first_char_lowercase(${FIRST_COMPONENT} C_VARIABLE)
    set(SHADER_FILE ${FILE})
    set(C_HEADER_FILE "${CMAKE_BINARY_DIR}/${FIRST_COMPONENT}.h")
    string(TOUPPER ${FIRST_COMPONENT} CAPS_FIRST_COMPONENT)
    set(HEADER_DEF "#ifndef ${CAPS_FIRST_COMPONENT}\n#define ${CAPS_FIRST_COMPONENT}\n")
    configure_file(${SHADER_FILE} ${C_HEADER_FILE} COPYONLY)
    file(READ ${SHADER_FILE} SHADER_CONTENT)
    file(WRITE ${C_HEADER_FILE} "${HEADER_DEF}const char *${C_VARIABLE} = R\"(${SHADER_CONTENT})\";\n#endif")  
endforeach()
